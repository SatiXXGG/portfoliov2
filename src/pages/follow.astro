---
import NavBar from "../components/nav-bar.astro";
import Layout from "../layouts/Layout.astro";
// Import the functions you need from the SDKs you need

// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries
---

<Layout title="Following">
  <NavBar />
  <main class="flex flex-col items-center">
    <div class="flex flex-row">
      <input
        id="followId"
        class="w-62 h-8 bg-black rounded-2xl text-center text-white"
        placeholder="Id here"
      />
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="icon icon-tabler icon-tabler-search bg-white rounded-full p-1 cursor-pointer mt-1 ml-3"
        width="24"
        id="followSearch"
        height="24"
        viewBox="0 0 24 24"
        stroke-width="2"
        stroke="currentColor"
        fill="none"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0"></path>
        <path d="M21 21l-6 -6"></path>
      </svg>
    </div>
    <nav class="grid grid-cols-1" id="currentTasks"></nav>

    <p class="text-white">
      If you can't follow your services please create a account and ask me to
      add the services and Ill provide a code to check the services!
    </p>

    <p class="text-red-700">This system is still in Beta</p>
  </main>

  <script>
    import { initializeApp } from "firebase/app";
    import { onAuthStateChanged } from "firebase/auth";
    import { getAuth } from "firebase/auth";
    import { getFirestore } from "firebase/firestore";
    import { collection, getDocs } from "firebase/firestore";
    const firebaseConfig = {
      apiKey: "AIzaSyA8QmYfTC6v5T1UZpqxarSExNWXZ9ahKDA",
      authDomain: "portfolio-7a5f5.firebaseapp.com",
      projectId: "portfolio-7a5f5",
      storageBucket: "portfolio-7a5f5.appspot.com",
      messagingSenderId: "198869603584",
      appId: "1:198869603584:web:85d2b2c5091f28737e4fe5",
      measurementId: "G-PQWQB1D72S",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const fs = getFirestore(app);
    //some data
    const tasks = document.getElementById("currentTasks");
    const followSearch = document.getElementById("followSearch");

    let html = "";
    followSearch.addEventListener("click", (e) => {
      while (tasks.firstChild) {
        tasks.removeChild(tasks.firstChild);
      }

      const followId = document.getElementById("followId").value;
      tasks.innerHTML = "";
      getDocs(collection(fs, followId)).then((res) => {
        res.forEach((doc) => {
          const data = doc.data();
          let compElement = "";
          if (data.completed) {
            compElement = `<div class="bg-green-600  rounded-full w-7 h-3 absolute right-3 top-3"></div>`;
          } else {
            compElement = `<div class="bg-red-500 rounded-full w-7 h-3 absolute right-3 top-3"></div>`;
          }

          const string = `<div class="md:w-[50vw] w-[85vw] rounded-2xl bg-black h-auto p-3 relative mt-2 transition-all duration-200 hover:scale-105">
              <h1 class="text-white font-bold ml-5 text-2xl">${data.title}</h1>
              <h2 class="text-gray-400 text-xl ml-5 font-light">${data.description}</h2>
              ${compElement}

               <p class="text-white text-sm font-extralight ml-5 mt-4">Added on: ${data.date}</p>
               <p class="text-white text-sm font-extralight ml-5 float-left">USD: ${data.price}</p>
            </div>`;
          html += string;
          tasks.innerHTML = html;
        });
      });
    });
  </script>
</Layout>

<style is:global>
  body {
    font-family:
      system-ui,
      -apple-system,
      BlinkMacSystemFont,
      "Segoe UI",
      Roboto,
      Oxygen,
      Ubuntu,
      Cantarell,
      "Open Sans",
      "Helvetica Neue",
      sans-serif;

    background-color: rgb(33, 33, 33);
  }
</style>
